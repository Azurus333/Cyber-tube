<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Video Downloader ‚Äî .onion</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
* { box-sizing: border-box; }
body { 
    margin: 0; 
    font-family: 'Courier New', monospace; 
    background: #000; 
    color: #0f0; 
    overflow-x: hidden; 
    position: relative; 
}
body::before { 
    content: ''; 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background: rgba(0, 0, 0, 0); 
    z-index: 0; 
}
.matrix-bg { 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    z-index: 1; 
    opacity: 0.1; 
    pointer-events: none; 
    background: linear-gradient(180deg, transparent 0%, #001a00 50%, transparent 100%); 
}
header { 
    background: rgba(0,20,0,0.95); 
    padding: 20px; 
    text-align: center; 
    border-bottom: 2px solid #0f0; 
    position: relative; 
    z-index: 10; 
    backdrop-filter: blur(10px); 
}
header h1 { 
    margin:0; 
    font-size:32px; 
    letter-spacing:4px; 
    text-transform:uppercase; 
    text-shadow: 0 0 10px #0f0, 0 0 20px #0f0; 
}
nav { 
    display:flex; 
    justify-content:center; 
    gap:20px; 
    margin-top:15px; 
    flex-wrap: wrap; 
}
nav a { 
    color:#0f0; 
    text-decoration:none; 
    font-weight:bold; 
    cursor:pointer; 
    padding: 8px 15px; 
    border: 1px solid #0f0; 
    transition: all 0.3s; 
    position: relative; 
}
nav a:hover { 
    background: #0f0; 
    color: #000; 
    box-shadow: 0 0 15px #0f0; 
}
.container { 
    max-width:900px; 
    margin:30px auto; 
    padding:20px; 
    background:rgba(0,20,0,0.95); 
    border-radius:10px; 
    box-shadow:0 0 30px rgba(0,255,0,0.2); 
    border: 1px solid #0f0; 
    display:none; 
    position: relative; 
    z-index: 10; 
    backdrop-filter: blur(10px); 
}
.container.active { display:block; }
h2 { 
    margin-top:0; 
    color:#0f0; 
    text-shadow: 0 0 10px #0f0; 
    border-bottom: 1px solid #0f0; 
    padding-bottom: 10px; 
}
input, textarea, select { 
    width:100%; 
    padding:12px; 
    margin:10px 0; 
    border-radius:5px; 
    border:1px solid #0f0; 
    background:#001a00; 
    color:#0f0; 
    font-family: 'Courier New', monospace; 
}
input:focus, textarea:focus, select:focus { 
    outline: none; 
    box-shadow: 0 0 10px #0f0; 
}
button { 
    width:100%; 
    padding:12px; 
    border:1px solid #0f0; 
    background:#0f0; 
    color:#000; 
    font-weight:bold; 
    border-radius:5px; 
    cursor:pointer; 
    font-family: 'Courier New', monospace; 
    transition: all 0.3s; 
    text-transform: uppercase; 
    margin-top: 10px;
}
button:hover { 
    box-shadow: 0 0 20px #0f0; 
    transform: scale(1.02); 
}
button:disabled { 
    opacity: 0.5; 
    cursor: not-allowed; 
}
button.secondary {
    background: rgba(0,20,0,0.5);
    color: #0f0;
}
button.secondary:hover {
    background: rgba(0,255,0,0.2);
}
.info-box {
    background: #001a00;
    border: 1px solid #0f0;
    padding: 15px;
    margin: 15px 0;
    border-radius: 5px;
}
.info-box h3 {
    color: #0f0;
    margin-top: 0;
    font-size: 16px;
}
.info-box p {
    margin: 8px 0;
    line-height: 1.6;
}
.format-list {
    max-height: 300px;
    overflow-y: auto;
    background: #000;
    border: 1px solid #0f0;
    padding: 10px;
    margin: 10px 0;
    border-radius: 5px;
}
.format-item {
    padding: 8px;
    margin: 5px 0;
    background: #001a00;
    border: 1px solid #0f0;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s;
}
.format-item:hover {
    background: rgba(0,255,0,0.1);
    box-shadow: 0 0 10px rgba(0,255,0,0.3);
}
.format-item.selected {
    background: rgba(0,255,0,0.2);
    border-color: #0ff;
}
.loading { 
    text-align: center; 
    padding: 40px; 
    color: #0f0; 
}
.loading::after {
    content: '...';
    animation: dots 1.5s steps(4, end) infinite;
}
@keyframes dots {
    0%, 20% { content: '.'; }
    40% { content: '..'; }
    60%, 100% { content: '...'; }
}
.error {
    background: rgba(255, 0, 0, 0.1);
    border: 1px solid #f00;
    color: #f00;
    padding: 15px;
    border-radius: 5px;
    margin: 15px 0;
}
.success {
    background: rgba(0, 255, 0, 0.1);
    border: 1px solid #0f0;
    color: #0f0;
    padding: 15px;
    border-radius: 5px;
    margin: 15px 0;
}
.subtitle-langs {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin: 10px 0;
}
.lang-badge {
    background: #001a00;
    border: 1px solid #0f0;
    padding: 5px 10px;
    border-radius: 3px;
    font-size: 12px;
}
</style>
</head>
<body>
<div class="matrix-bg"></div>
<header>
<h1>VIDEO DOWNLOADER</h1>
<nav>
    <a onclick="showSection('download')">[ T√âL√âCHARGER ]</a>
    <a onclick="showSection('inspect')">[ INSPECTER ]</a>
    <a onclick="showSection('about')">[ √Ä PROPOS ]</a>
</nav>
</header>

<div class="container active" id="download">
    <h2>> T√©l√©charger une vid√©o</h2>
    <p>Entrez l'URL de la vid√©o YouTube que vous souhaitez t√©l√©charger :</p>
    <input type="text" id="downloadUrl" placeholder="https://www.youtube.com/watch?v=...">
    <button onclick="downloadVideo()" id="downloadBtn">T√©l√©charger</button>
    <div id="downloadStatus"></div>
</div>

<div class="container" id="inspect">
    <h2>> Inspecter une vid√©o</h2>
    <p>Obtenez des informations d√©taill√©es sur une vid√©o sans la t√©l√©charger :</p>
    <input type="text" id="inspectUrl" placeholder="https://www.youtube.com/watch?v=...">
    <button onclick="inspectVideo()" id="inspectBtn">Inspecter</button>
    <div id="inspectStatus"></div>
    <div id="videoInfo"></div>
</div>

<div class="container" id="about">
    <h2>> √Ä propos</h2>
    <div class="info-box">
        <h3>üé¨ Video Downloader</h3>
        <p>Cette application vous permet de t√©l√©charger des vid√©os YouTube et d'inspecter leurs m√©tadonn√©es.</p>
        
        <h3 style="margin-top: 20px;">‚öôÔ∏è Fonctionnalit√©s</h3>
        <p><strong>T√âL√âCHARGER :</strong> T√©l√©chargez des vid√©os en qualit√© maximale (meilleure vid√©o + meilleur audio fusionn√©s).</p>
        <p><strong>INSPECTER :</strong> Consultez les informations d√©taill√©es : titre, dur√©e, formats disponibles, sous-titres, etc.</p>
        
        <h3 style="margin-top: 20px;">üîß API Endpoints</h3>
        <p><strong>POST /download</strong> - T√©l√©charge une vid√©o</p>
        <p><strong>GET /inspect</strong> - Inspecte les m√©tadonn√©es d'une vid√©o</p>
        
        <h3 style="margin-top: 20px;">‚ö†Ô∏è Configuration requise</h3>
        <p>Pour utiliser cette interface, votre API FastAPI doit √™tre en cours d'ex√©cution sur <code style="background:#000; padding:2px 5px; border-radius:3px;">http://localhost:8000</code></p>
        <p>Lancez votre serveur avec : <code style="background:#000; padding:2px 5px; border-radius:3px;">uvicorn main:app --reload</code></p>
    </div>
</div>

<script>
const API_BASE = 'http://localhost:8000';

function showSection(id) {
    document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
    const section = document.getElementById(id);
    if (section) section.classList.add('active');
}

async function downloadVideo() {
    const url = document.getElementById('downloadUrl').value.trim();
    const statusDiv = document.getElementById('downloadStatus');
    const btn = document.getElementById('downloadBtn');
    
    if (!url) {
        statusDiv.innerHTML = '<div class="error">‚ö†Ô∏è Veuillez entrer une URL</div>';
        return;
    }
    
    btn.disabled = true;
    statusDiv.innerHTML = '<div class="loading">T√©l√©chargement en cours</div>';
    
    try {
        const formData = new FormData();
        formData.append('url', url);
        
        const response = await fetch(`${API_BASE}/download`, {
            method: 'POST',
            body: formData
        });
        
        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.detail || 'Erreur lors du t√©l√©chargement');
        }
        
        // Cr√©er un lien de t√©l√©chargement
        const blob = await response.blob();
        const downloadUrl = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = downloadUrl;
        a.download = 'video.mp4';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(downloadUrl);
        document.body.removeChild(a);
        
        statusDiv.innerHTML = '<div class="success">‚úÖ Vid√©o t√©l√©charg√©e avec succ√®s !</div>';
    } catch (error) {
        statusDiv.innerHTML = `<div class="error">‚ùå Erreur : ${error.message}</div>`;
    } finally {
        btn.disabled = false;
    }
}

async function inspectVideo() {
    const url = document.getElementById('inspectUrl').value.trim();
    const statusDiv = document.getElementById('inspectStatus');
    const infoDiv = document.getElementById('videoInfo');
    const btn = document.getElementById('inspectBtn');
    
    if (!url) {
        statusDiv.innerHTML = '<div class="error">‚ö†Ô∏è Veuillez entrer une URL</div>';
        return;
    }
    
    btn.disabled = true;
    statusDiv.innerHTML = '<div class="loading">Inspection en cours</div>';
    infoDiv.innerHTML = '';
    
    try {
        const response = await fetch(`${API_BASE}/inspect?url=${encodeURIComponent(url)}`);
        
        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.detail || 'Erreur lors de l\'inspection');
        }
        
        const data = await response.json();
        
        statusDiv.innerHTML = '<div class="success">‚úÖ Inspection termin√©e</div>';
        
        // Afficher les informations
        let html = '<div class="info-box">';
        html += `<h3>üìπ ${data.title || 'Titre inconnu'}</h3>`;
        html += `<p><strong>Dur√©e :</strong> ${formatDuration(data.duration)}</p>`;
        html += `<p><strong>Auteur :</strong> ${data.uploader || 'Inconnu'}</p>`;
        html += `<p><strong>Langue :</strong> ${data.language || 'Non sp√©cifi√©e'}</p>`;
        html += '</div>';
        
        // Sous-titres manuels
        if (data.manual_subtitle_languages && data.manual_subtitle_languages.length > 0) {
            html += '<div class="info-box">';
            html += '<h3>üìù Sous-titres manuels disponibles</h3>';
            html += '<div class="subtitle-langs">';
            data.manual_subtitle_languages.forEach(lang => {
                html += `<span class="lang-badge">${lang}</span>`;
            });
            html += '</div></div>';
        }
        
        // Sous-titres automatiques
        if (data.auto_subtitle_languages && data.auto_subtitle_languages.length > 0) {
            html += '<div class="info-box">';
            html += '<h3>ü§ñ Sous-titres automatiques disponibles</h3>';
            html += '<div class="subtitle-langs">';
            data.auto_subtitle_languages.forEach(lang => {
                html += `<span class="lang-badge">${lang}</span>`;
            });
            html += '</div></div>';
        }
        
        // Formats vid√©o
        if (data.video_formats && data.video_formats.length > 0) {
            html += '<div class="info-box">';
            html += '<h3>üé• Formats vid√©o disponibles</h3>';
            html += '<div class="format-list">';
            data.video_formats.slice(0, 10).forEach(format => {
                html += '<div class="format-item">';
                html += `<strong>ID:</strong> ${format.id} | `;
                html += `<strong>R√©solution:</strong> ${format.width}x${format.height} | `;
                html += `<strong>FPS:</strong> ${format.fps || 'N/A'} | `;
                html += `<strong>Ext:</strong> ${format.ext}`;
                html += '</div>';
            });
            if (data.video_formats.length > 10) {
                html += `<p style="text-align:center; padding:10px; color:#888;">... et ${data.video_formats.length - 10} autres formats</p>`;
            }
            html += '</div></div>';
        }
        
        // Formats audio
        if (data.audio_formats && data.audio_formats.length > 0) {
            html += '<div class="info-box">';
            html += '<h3>üîä Formats audio disponibles</h3>';
            html += '<div class="format-list">';
            data.audio_formats.slice(0, 10).forEach(format => {
                html += '<div class="format-item">';
                html += `<strong>ID:</strong> ${format.id} | `;
                html += `<strong>ABR:</strong> ${format.abr || 'N/A'} kbps | `;
                html += `<strong>Ext:</strong> ${format.ext}`;
                html += '</div>';
            });
            if (data.audio_formats.length > 10) {
                html += `<p style="text-align:center; padding:10px; color:#888;">... et ${data.audio_formats.length - 10} autres formats</p>`;
            }
            html += '</div></div>';
        }
        
        infoDiv.innerHTML = html;
    } catch (error) {
        statusDiv.innerHTML = `<div class="error">‚ùå Erreur : ${error.message}</div>`;
        infoDiv.innerHTML = '';
    } finally {
        btn.disabled = false;
    }
}

function formatDuration(seconds) {
    if (!seconds) return 'Inconnue';
    const hrs = Math.floor(seconds / 3600);
    const mins = Math.floor((seconds % 3600) / 60);
    const secs = Math.floor(seconds % 60);
    
    if (hrs > 0) {
        return `${hrs}h ${mins}m ${secs}s`;
    } else if (mins > 0) {
        return `${mins}m ${secs}s`;
    } else {
        return `${secs}s`;
    }
}
</script>
</body>
</html>